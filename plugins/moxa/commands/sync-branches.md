---
allowed-tools: Bash(git:*), AskUserQuestion, Skill
argument-hint: <branch1> <branch2> [branch3...]
description: Compare commits across multiple branches and cherry-pick sync missing commits with automatic MR creation
---

# Sync Branches - Cherry-Pick åŒæ­¥å·¥ä½œæµç¨‹

æ¯”å°å¤šå€‹é ç«¯åˆ†æ”¯èˆ‡ç•¶å‰åˆ†æ”¯çš„ commits å·®ç•°ï¼Œç¢ºä¿æ‰€æœ‰ commits éƒ½å·²åŒæ­¥ã€‚å°éœ€è¦åŒæ­¥çš„åˆ†æ”¯é€ä¸€åŸ·è¡Œ cherry-pick ä¸¦å»ºç«‹ MRã€‚

åŸ·è¡Œåƒæ•¸: $ARGUMENTS

## ç•¶å‰å€‰åº«ç‹€æ…‹

- å°ˆæ¡ˆç›®éŒ„: !`basename $(pwd)`
- ç•¶å‰åˆ†æ”¯: !`git branch --show-current`
- Git ç‹€æ…‹: !`git status --short`
- Remote è³‡è¨Š: !`git remote -v`

## å‰ç½®æª¢æŸ¥

1. **æª¢æŸ¥å·¥ä½œç›®éŒ„æ˜¯å¦ä¹¾æ·¨ï¼š**
   - å¦‚æœæœ‰æœªæäº¤çš„è®Šæ›´ï¼Œæé†’ä½¿ç”¨è€…å…ˆ commit æˆ– stash
   - ä½¿ç”¨ `git status --short` ç¢ºèª

2. **æª¢æŸ¥ç•¶å‰åˆ†æ”¯ä¸æ˜¯ main/masterï¼š**
   - ç¢ºèªç•¶å‰åˆ†æ”¯æ˜¯åŠŸèƒ½åˆ†æ”¯è€Œéä¸»åˆ†æ”¯

## æµç¨‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       /sync-branches <branch1> <branch2> [branch3...]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Step 1: æ¯”å°å„åˆ†æ”¯      â”‚
           â”‚  é©—è­‰åˆ†æ”¯ + æ¯”å° commits â”‚
           â”‚  ç”¢å‡ºåŒæ­¥ç‹€æ…‹å ±å‘Š        â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Step 2: é¸æ“‡åŒæ­¥ç›®æ¨™    â”‚
           â”‚  é¸æ“‡è¦åŒæ­¥çš„åˆ†æ”¯        â”‚
           â”‚  ç¢ºèª commit æ¸…å–®        â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Step 3: é€ä¸€åŸ·è¡ŒåŒæ­¥    â”‚
           â”‚  Cherry-pick + å»ºç«‹ MR   â”‚
           â”‚  è¼¸å‡ºç¶œåˆå ±å‘Š            â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åŸ·è¡Œæ­¥é©Ÿ

### Step 1: æ¯”å°å„åˆ†æ”¯ Commits å·®ç•°

è§¸ç™¼ `moxa:scan-branches` skillã€‚

**åˆ†æ”¯åç¨±ä¾†æºï¼š**

**å¦‚æœ `$ARGUMENTS` æœ‰æä¾›åˆ†æ”¯åç¨±ï¼š**
- ç›´æ¥ä½¿ç”¨æä¾›çš„åˆ†æ”¯åç¨±ï¼ˆä»¥ç©ºæ ¼åˆ†éš”å¤šå€‹åˆ†æ”¯ï¼‰

**å¦å‰‡ï¼š**
- ä½¿ç”¨ AskUserQuestion è©¢å•ä½¿ç”¨è€…è¦æ¯”å°çš„åˆ†æ”¯åç¨±ï¼ˆå¯è¼¸å…¥å¤šå€‹ï¼Œä»¥ç©ºæ ¼æˆ–é€—è™Ÿåˆ†éš”ï¼‰

`moxa:scan-branches` æœƒè‡ªå‹•ï¼š
- åµæ¸¬ remoteï¼ˆupstream å„ªå…ˆï¼Œå¦å‰‡ originï¼‰
- åŸ·è¡Œ `git fetch` æ›´æ–°é ç«¯è³‡è¨Š
- é©—è­‰å„åˆ†æ”¯å­˜åœ¨æ–¼ remote
- é€ä¸€æ¯”å°ç•¶å‰åˆ†æ”¯èˆ‡å„ç›®æ¨™åˆ†æ”¯çš„ commits å·®ç•°
- éæ¿¾éåŠŸèƒ½æ€§ commits
- ç”¢å‡ºç¶œåˆåŒæ­¥ç‹€æ…‹å ±å‘Š

### Step 2: æª¢è¦–å ±å‘Šä¸¦é¸æ“‡åŒæ­¥ç›®æ¨™

æ”¶åˆ° `moxa:scan-branches` çš„åŒæ­¥ç‹€æ…‹å ±å‘Šå¾Œå±•ç¤ºï¼š

```
## åˆ†æ”¯åŒæ­¥ç‹€æ…‹å ±å‘Š

ä¾†æºåˆ†æ”¯: feature/my-feature

### switch-mds-g4000 (5 commits éœ€è¦åŒæ­¥)
  1. abc1234 feat(api): add new endpoint
  2. def5678 fix(auth): fix login issue
  3. ghi9012 refactor: optimize query
  4. jkl3456 feat(ui): add dashboard
  5. mno7890 fix(core): memory leak

### switch-mds-g4100 (2 commits éœ€è¦åŒæ­¥)
  1. abc1234 feat(api): add new endpoint
  2. jkl3456 feat(ui): add dashboard

### switch-eis-series (0 commits - å·²åŒæ­¥)
  âœ“ æ‰€æœ‰ commits å·²åŒæ­¥

---
ç¸½çµï¼š3 å€‹åˆ†æ”¯ä¸­ï¼Œ2 å€‹éœ€è¦åŒæ­¥ï¼Œ1 å€‹å·²å®Œå…¨åŒæ­¥
```

ä½¿ç”¨ AskUserQuestion è©¢å•ï¼š

```
ä»¥ä¸Šæ˜¯å„åˆ†æ”¯çš„åŒæ­¥ç‹€æ…‹ã€‚è«‹é¸æ“‡è¦åŸ·è¡ŒåŒæ­¥çš„åˆ†æ”¯ï¼š

1. å…¨éƒ¨éœ€è¦åŒæ­¥çš„åˆ†æ”¯éƒ½åŸ·è¡Œ
2. åªåŒæ­¥éƒ¨åˆ†åˆ†æ”¯ï¼ˆè«‹èªªæ˜ï¼‰
3. éœ€è¦æ’é™¤éƒ¨åˆ† commitsï¼ˆè«‹èªªæ˜è¦æ’é™¤çš„ commit hashï¼‰
```

å¦‚æœä½¿ç”¨è€…è¦æ’é™¤ commits æˆ–è·³éåˆ†æ”¯ï¼Œèª¿æ•´æ¸…å–®å¾Œå†æ¬¡ç¢ºèªã€‚

### Step 3: é€ä¸€åŸ·è¡Œ Cherry-Pick åŒæ­¥

å°æ¯å€‹éœ€è¦åŒæ­¥çš„åˆ†æ”¯ï¼Œè§¸ç™¼ `moxa:cherry-pick-sync` skillï¼š

- é€ä¸€å‚³å…¥ç›®æ¨™åˆ†æ”¯èˆ‡å°æ‡‰çš„ commits æ¸…å–®
- `moxa:cherry-pick-sync` å°æ¯å€‹åˆ†æ”¯æœƒï¼š
  1. åŸºæ–¼ç›®æ¨™åˆ†æ”¯å»ºç«‹ `sync/<source>-to-<target>` åˆ†æ”¯
  2. Cherry-pick commitsï¼ˆå¾æœ€èˆŠåˆ°æœ€æ–°ï¼‰
  3. è¡çªæ™‚ä¸­æ­¢ä¸¦æ¸…ç†è©²åˆ†æ”¯ï¼Œç¹¼çºŒè™•ç†ä¸‹ä¸€å€‹
  4. æˆåŠŸå¾Œ push åˆ†æ”¯
  5. å‘¼å« `moxa:create-pr` å»ºç«‹ MRï¼ˆå›ºå®šæ ¼å¼æ¨¡æ¿ï¼‰
  6. åˆ‡å›åŸå§‹åˆ†æ”¯

### ç¶œåˆå ±å‘Š

æ‰€æœ‰åˆ†æ”¯è™•ç†å®Œç•¢å¾Œå±•ç¤ºç¶œåˆå ±å‘Šï¼š

```
## Cherry-Pick Sync ç¶œåˆçµæœ

### âœ… æˆåŠŸåŒæ­¥
| ç›®æ¨™åˆ†æ”¯ | Sync åˆ†æ”¯ | Commits | MR |
|----------|-----------|---------|-----|
| switch-mds-g4000 | sync/feature-x-to-switch-mds-g4000 | 5 | !123 |
| switch-mds-g4100 | sync/feature-x-to-switch-mds-g4100 | 2 | !124 |

### âŒ åŒæ­¥å¤±æ•—ï¼ˆè¡çªï¼‰
| ç›®æ¨™åˆ†æ”¯ | è¡çª Commit | éœ€æ‰‹å‹•è™•ç† |
|----------|-------------|-----------|
| (ç„¡) |

### ğŸ“Š çµ±è¨ˆ
- ç¸½è¨ˆç›®æ¨™åˆ†æ”¯: 2
- æˆåŠŸ: 2
- å¤±æ•—: 0
- å·²å»ºç«‹ MR: 2
```

## å…§éƒ¨æŠ€èƒ½

| æ­¥é©Ÿ | Skill | å‚™è¨» |
|------|-------|------|
| æ¯”å°å¤šåˆ†æ”¯å·®ç•° | `moxa:scan-branches` | é©—è­‰åˆ†æ”¯ã€é€ä¸€æ¯”å° commitsã€éæ¿¾éåŠŸèƒ½ commits |
| åŸ·è¡Œ cherry-pick | `moxa:cherry-pick-sync` | é€ä¸€åˆ†æ”¯ cherry-pickã€å»ºç«‹ sync åˆ†æ”¯ã€è™•ç†è¡çª |
| å»ºç«‹ MR | `moxa:create-pr` | å»ºç«‹ GitLab Merge Request |

## ä½¿ç”¨ç¯„ä¾‹

```bash
# æ¯”å°å¤šå€‹åˆ†æ”¯
/sync-branches switch-mds-g4000 switch-mds-g4100 switch-eis-series

# æ¯”å°å…©å€‹åˆ†æ”¯
/sync-branches switch-mds-g4000 switch-mds-g4100

# äº’å‹•æ¨¡å¼ï¼ˆæœƒè©¢å•è¦æ¯”å°çš„åˆ†æ”¯åç¨±ï¼‰
/sync-branches
```

## æ³¨æ„äº‹é …

1. **å·¥ä½œç›®éŒ„å¿…é ˆä¹¾æ·¨**ï¼šåŸ·è¡Œå‰éœ€ç¢ºä¿æ²’æœ‰æœªæäº¤çš„è®Šæ›´
2. **è¡çªè™•ç†**ï¼šé‡åˆ°è¡çªæœƒåœæ­¢è©²åˆ†æ”¯çš„åŒæ­¥ï¼Œç¹¼çºŒè™•ç†ä¸‹ä¸€å€‹åˆ†æ”¯
3. **åˆ†æ”¯å‘½å**ï¼šsync åˆ†æ”¯ä½¿ç”¨ `sync/<source>-to-<target>` æ ¼å¼
4. **MR æ ¼å¼**ï¼šä½¿ç”¨å›ºå®šæ¨¡æ¿ï¼Œåˆ—å‡ºæ‰€æœ‰ cherry-pick çš„ commits
5. **å®‰å…¨æ€§**ï¼šä¸æœƒä¿®æ”¹ä»»ä½•ç¾æœ‰åˆ†æ”¯çš„ commitsï¼Œåƒ…å»ºç«‹æ–°çš„ sync åˆ†æ”¯
6. **è‡ªå‹•éæ¿¾**ï¼šè‡ªå‹•æ’é™¤ merge commitsã€release commits ç­‰éåŠŸèƒ½æ€§ commits
